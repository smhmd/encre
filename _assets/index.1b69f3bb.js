function e(e){return"string"==typeof e}function t(e){return Array.isArray(e)}function n(e){return"object"==typeof e}function o(e){return"function"==typeof e}function r(e){return e.nodeType===Node.ELEMENT_NODE}function i(e){return r(e)&&!getComputedStyle(e).display.match(/(?:inline)/)}function l(e){return e.replace(/\B([A-Z])/,"-$1").toLowerCase()}class c extends Error{constructor(e=""){super("[Encre Error]: "+e)}}function s(e,o){if("object"!=typeof o)return{};const r=t(e)?[]:{};let i;for(let t in e){if(i=e[t],Object.prototype.hasOwnProperty.call(o,t)&&(l=i,c=o[t],typeof l==typeof c)){let e=o[t];n(e)&&(e=s(i,e)),i=e}r[t]=i}var l,c;return r}function u(e){let o,r=[];if(t(e))for(let t=0;t<e.length;t++)e[t]&&(r=r.concat(d(e[t])));else if(n(e))for(let t in e)o=e[t],o&&(r=r.concat(t.split(" ")));else r=r.concat(e.split(" "));return r}function a(e){let o,r={};if(t(e))for(let t=0;t<e.length;t++)e[t]&&(r=Object.assign({},r,a(e[t])));else if(n(e))r=e;else{let t,n,i;o=e.split(";");for(let e=0;e<o.length;e++)t=o[e],t.match(/([\S]+): ?([\S]+);?/)&&(n=l(RegExp.$1),i=RegExp.$2,n&&i&&(r[n]=i))}return r}function d(e){return void 0===e?[]:t(e)?e:[e]}function f(...n){const o=n.length;let r=document.createDocumentFragment();if(0===o)return r;if(!e(n[0]))return t(n[0])?(r.append(...n[0]),r):n[0];let i=e(n[0])?n[0]:"div";r=document.createElement(i);let c=[];if(o>=2){"[object Object]"===Object.prototype.toString.call(n[1])?function(e,t){if(!(e instanceof HTMLElement))return;let n;for(let o in t)switch(n=t[o],o){case"style":{const t=a(n);for(let n in t)e.style.setProperty(l(n),String(t[n]));break}case"class":{const t=u(n);e.className=t.join(" ");break}default:if(o.match(/on([A-Z].*)/)){let t;(t=RegExp.$1.toLowerCase())&&e.addEventListener(t,n,!1)}else e.setAttribute(o,n)}}(r,n[1]):c=c.concat(d(n[1]));for(let e=2;e<o;e++)c=c.concat(d(n[e]))}return r.append(...c),r}function g(...e){let t;const n={};for(let o=0;o<e.length;o++){let r;t=e[o];for(let e in t)switch(r=t[e],e){case"class":case"style":{n[e]||(n[e]=[]);const t="class"===e?u(r):a(r);n[e]=n[e].concat(t);break}default:n[e]=t[e]}}return n}function m(){return window.getSelection()}function p(){let e;return(e=m())&&0!==e.rangeCount?e.getRangeAt(0):null}function h(e,t){let n;if(!(n=m()))return null;n.removeAllRanges();const o=document.createRange();return o.selectNodeContents(e),o.setStart(e,t),o.setEnd(e,t),o.collapse(!1),n.addRange(o),o}function C(e){return h(e,e.textContent?.length||0)}function b(e,t){const n=[e];let r;for(;n.length>0;){if(!(r=n.shift()))return;if(t&&o(t)&&t.call(null,r))return r;for(let e=0;e<r.childNodes.length;e++)n.push(r.childNodes.item(e))}}function k(e,t){let n=e;for(;n;){if(t&&o(t)&&t.call(null,n))return n;n=n.parentNode}}function v(e){let t=e;for(;t;){if(!t.lastChild)return t;t=t.lastChild}return t}function y(e){let t,n=e.cloneNode();i(e)&&(n=document.createDocumentFragment());for(let o=0;o<e.childNodes.length;o++)t=y(e.childNodes.item(o)),n.appendChild(t);return n}var E,x;(x=E||(E={})).editor="editor-content",x.container="editor-container",x.block="editor-block",x.blockContent="editor-block-content";const N={readonly:!1,autofocus:!0,classes:{editor:"editor",container:"editor__container",block:"editor-block",focused:"editor-block--focused","block-content":"editor-block__content"}};function w(e){return b(e,(e=>r(e)&&O(e)))}function S(e,t){let n,o,r,i,l=null;if(e.cursoringBlock&&(i=w(e.cursoringBlock))&&i.childElementCount>0&&!i.textContent?.length)return void function(e){let t,n;if(!(t=e.elm)||!(n=e.cursoringBlock))return;const o=e.renderNewBlock(),r=t.insertBefore(o,n.nextElementSibling);t.removeChild(n);const i=v(r);e.range=C(i)}(e);if(!((n=e.range)&&n.collapsed&&0===n.startOffset&&(o=e.cursoringBlock)&&(r=e.elm)&&(l=function(e){let t=e;for(;t;){if(!t.firstChild)return t;t=t.firstChild}return t}(o))&&l.isSameNode(n.startContainer)))return;let c=o.previousElementSibling;if(!o.textContent?.length){if(!c){if(!w(o))return;const t=e.renderNewBlock();c=r.insertBefore(t,o.nextElementSibling)}r.removeChild(o)}if(!c)return;const s=v(c);s.textContent+=" ",e.range=C(s)}function B(e,t){let n,o,l,c,s,u;if(!((n=e.range)&&n.collapsed&&(o=k(n.startContainer,(e=>r(e)&&i(e))))&&(l=e.cursoringBlock)&&(c=e.elm)))return t.preventDefault();if(O(o)){t.preventDefault();const e=v(o);n.setEnd(e,e.textContent?.length||0),u=n.extractContents()}else{if(o.textContent?.length||!o.previousElementSibling||o.nextElementSibling)return;t.preventDefault(),o.parentElement?.removeChild(o)}s=c.insertBefore(e.renderNewBlock(u),l.nextElementSibling),e.range=h(v(s),0)}function _(e,t){switch(t.key){case"Enter":B(e,t);break;case"Backspace":S(e);break;case"Tab":!function(e,t){let n;if(t.preventDefault(),!(n=e.range))return;const o=" ".repeat(4);n.collapsed||n.deleteContents(),n.insertNode(document.createTextNode(o)),n.collapse(!1),e.range=n}(e,t)}}function A(e){let t;(t=p())&&e.range!==t&&(e.range=t)}function L(e){return function(t){return t.getAttribute("role")===e}}const D=L(E.editor),$=L(E.block),O=L(E.blockContent);let R=0;function j(t,n={},l=[]){const c=R++,u=function(e,...t){let n=e;for(let e=0;e<t.length;e++)n=s(n,t[e]);return n}(N,n),a=u.classes;let m,p,h,C;const v=[];const y={get elm(){return b(t,(e=>r(e)&&D(e)&&e._uid===c))},get plugins(){return m},get range(){return h},set range(e){var t;(t=e)&&y.elm?.contains(t.commonAncestorContainer)&&k(t.commonAncestorContainer,(e=>r(e)&&O(e)))&&(h=e,(()=>{if(!h)return;const e=h.commonAncestorContainer,t=C;if(t&&t.contains(e))return;const n=k(e,(e=>r(e)&&$(e)));n&&(C=n,t?.classList.remove(a.focused),C.classList.add(a.focused))})(),function(){let e;for(let t=0;t<v.length;t++)e=v[t],e&&o(e)&&e.call(null)}(),(()=>{let e,t;if(C&&(e=w(C)))for(let n=0;n<e.childNodes.length;)t=e.childNodes.item(n),i(t)||t.textContent?.length?n++:e.removeChild(t)})())},onRangeSaved(e){e&&o(e)&&v.push(e)},get cursoringBlock(){return C},renderNewBlock(t="p",n={},o,r){let i="p",l=[];e(t)?i=t||"p":l=d(t),o&&(l=l.concat(d(o)));const c=f(i,g(n,u.readonly?{}:{contenteditable:!0},{role:E.blockContent}),l);if(r)for(let e in r)c[e]=r[e];return f("div",{class:u.classes?.block,role:E.block},c)}};m=function(e,t){let n;const r=new WeakMap;for(let i=0;i<t.length;i++)n=t[i],o(n[0])&&r.set(n[0],new n[0](e,...n[1]));return{get:e=>r.get(e)}}(y,l),p=u.readonly?{}:function(e){const t={isComposing:!1,isPointerDown:!1,timerId:0};return{onKeydown:n=>{t.isComposing||(A(e),_(e,n))},onKeyup:()=>{t.isComposing||A(e)},onCompositionstart:()=>{t.isComposing=!0},onCompositionend:()=>{t.isComposing=!1},onPointerdown:()=>{t.isPointerDown=!0,A(e)},onPointerup:n=>{t.isPointerDown=!1,A(e)}}}(y);const x=y.renderNewBlock(),S=f("div",g({class:a.editor,role:E.editor},p),x);S._uid=c;const B=f("div",{role:E.container,class:a.container,spellcheck:"false",tabindex:"-1"},S);return t.appendChild(B),y}let P=0;class T{constructor(e){this.$editor=e,this._uid=++P}exec(){}isActive(){return!1}}function q(e){return class extends T{constructor(e){super(e),this._inner_role="list-"+this._uid}exec(){const{cursoringBlock:t,range:n,elm:o}=this.$editor;let r,i;if(!o||!t||!(r=w(t))||r.tagName===(e?"OL":"UL"))return;const l=e?"ol":"ul",c=document.createDocumentFragment();let s={};if(r.tagName===(e?"UL":"OL")){let e;for(let t=0;t<r.attributes.length;t++)e=r.attributes.item(t),e&&(s[e.name]=e.value);c.append(...r.childNodes)}else{s={class:"editor-list"};const e=y(r);c.append(f("li",{class:"editor-list-item"},e))}const u=this.$editor.renderNewBlock(l,s,c,{_inner_role:this._inner_role});i=t.nextElementSibling,o.removeChild(t);const a=v(o.insertBefore(u,i));this.$editor.range=C(a)}isActive(){let e;return!!(e=this.$editor.range)&&Boolean(k(e.startContainer,(e=>r(e)&&O(e)&&e._inner_role===this._inner_role)))}}}const F=q(!0),M=q();function K(e){return class extends T{constructor(e){super(e)}exec(t){document.execCommand(e,!1,t),this.$editor.range=p()}isActive(){return document.queryCommandState(e)}}}const U=K("bold"),Z=K("italic");const H=function(){const t=[],n={use:(e,...o)=>(t.push([e,o||[]]),n),mount(n,o={}){const r=e(n)?document.querySelector(n):n;if(!r)throw new c(`No Such Element "${n}"`);return j(r,o,t)}};return n}().use(M).use(F).use(Z).use(U).mount("#content");function I(e,t){document.querySelector(e)?.addEventListener("click",(()=>{H.plugins.get(t)?.exec()}),!1)}function W(e,t,n="active"){let o,r=document.querySelector(e);r&&(o=H.plugins.get(t))&&(o.isActive()?r.classList.add(n):r.classList.remove(n))}I("#ul",M),I("#ol",F),I("#bold",U),I("#italic",Z),H.onRangeSaved((()=>{W("#ul",M),W("#ol",F),W("#bold",U),W("#italic",Z)}));
