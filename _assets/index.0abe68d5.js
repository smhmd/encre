function e(e){return"string"==typeof e}function t(e){return Array.isArray(e)}function n(e){return"object"==typeof e}function o(e){return"function"==typeof e}function r(e){return e.nodeType===Node.ELEMENT_NODE}function i(e){return r(e)&&!getComputedStyle(e).display.match(/(?:inline)/)}function l(e){return e.replace(/\B([A-Z])/,"-$1").toLowerCase()}class c extends Error{constructor(e=""){super("[Encre Error]: "+e)}}function s(e,o){if("object"!=typeof o)return{};const r=t(e)?[]:{};let i;for(let t in e){if(i=e[t],Object.prototype.hasOwnProperty.call(o,t)&&(l=i,c=o[t],typeof l==typeof c)){let e=o[t];n(e)&&(e=s(i,e)),i=e}r[t]=i}var l,c;return r}function u(e){let o,r=[];if(t(e))for(let t=0;t<e.length;t++)e[t]&&(r=r.concat(d(e[t])));else if(n(e))for(let t in e)o=e[t],o&&(r=r.concat(t.split(" ")));else r=r.concat(e.split(" "));return r}function a(e){let o,r={};if(t(e))for(let t=0;t<e.length;t++)e[t]&&(r=Object.assign({},r,a(e[t])));else if(n(e))r=e;else{let t,n,i;o=e.split(";");for(let e=0;e<o.length;e++)t=o[e],t.match(/([\S]+): ?([\S]+);?/)&&(n=l(RegExp.$1),i=RegExp.$2,n&&i&&(r[n]=i))}return r}function d(e){return void 0===e?[]:t(e)?e:[e]}function f(...n){const o=n.length;let r=document.createDocumentFragment();if(0===o)return r;if(!e(n[0]))return t(n[0])?(r.append(...n[0]),r):n[0];let i=e(n[0])?n[0]:"div";r=document.createElement(i);let c=[];if(o>=2){"[object Object]"===Object.prototype.toString.call(n[1])?function(e,t){if(!(e instanceof HTMLElement))return;let n;for(let o in t)switch(n=t[o],o){case"style":{const t=a(n);for(let n in t)e.style.setProperty(l(n),String(t[n]));break}case"class":{const t=u(n);e.className=t.join(" ");break}default:if(o.match(/on([A-Z].*)/)){let t;(t=RegExp.$1.toLowerCase())&&e.addEventListener(t,n,!1)}else e.setAttribute(o,n)}}(r,n[1]):c=c.concat(d(n[1]));for(let e=2;e<o;e++)c=c.concat(d(n[e]))}return r.append(...c),r}function m(...e){let t;const n={};for(let o=0;o<e.length;o++){let r;t=e[o];for(let e in t)switch(r=t[e],e){case"class":case"style":{n[e]||(n[e]=[]);const t="class"===e?u(r):a(r);n[e]=n[e].concat(t);break}default:n[e]=t[e]}}return n}function g(){return window.getSelection()}function p(){let e;return(e=g())&&0!==e.rangeCount?e.getRangeAt(0):null}function h(e,t){let n;if(!(n=g()))return null;n.removeAllRanges();const o=document.createRange();return o.selectNodeContents(e),o.setStart(e,t),o.setEnd(e,t),o.collapse(),n.addRange(o),o}function C(e){return h(e,0)}function b(e,t){const n=[e];let r;for(;n.length>0;){if(!(r=n.shift()))return;if(t&&o(t)&&t.call(null,r))return r;for(let e=0;e<r.childNodes.length;e++)n.push(r.childNodes.item(e))}}function k(e,t){let n=e;for(;n;){if(t&&o(t)&&t.call(null,n))return n;n=n.parentNode}}function N(e){let t=e;for(;t;){if(!t.lastChild)return t;t=t.lastChild}return t}function v(e){let t=e;for(;t;){if(!t.firstChild)return t;t=t.firstChild}return t}function y(e){let t,n=e.cloneNode();i(e)&&(n=document.createDocumentFragment());for(let o=0;o<e.childNodes.length;o++)t=y(e.childNodes.item(o)),n.appendChild(t);return n}var E,x;(x=E||(E={})).editor="editor-content",x.container="editor-container",x.block="editor-block",x.blockContent="editor-block-content";const w={readonly:!1,autofocus:!0,classes:{editor:"editor",container:"editor__container",block:"editor-block",focused:"editor-block--focused","block-content":"editor-block__content"}};function S(e){return b(e,(e=>r(e)&&O(e)))}function _(e){return function(e,t){const n=[e];let r;for(;n.length>0;){if(!(r=n.pop()))return;if(t&&o(t)&&t.call(null,r))return r;for(let e=r.childNodes.length-1;e>=0;e--)n.push(r.childNodes.item(e))}}(e,(e=>"#text"===e.nodeName&&!!e.textContent?.length))}function A(e,t,n){switch(t.key){case"Enter":!function(e,t){let n,o;if(t.preventDefault(),!(n=e.range)||!(o=k(n.commonAncestorContainer,(e=>i(e)))))return;n.collapsed||n.deleteContents();const r=N(o);n.setEnd(r,r.textContent?.length||0);const l=n.extractContents();let c,s;if(O(o)||o.parentElement?.lastElementChild?.isSameNode(o)&&!o.textContent?.length){let t,n;if(!(t=e.elm))return;const r=e.renderNewBlock(l);if(c=t.insertBefore(r,(n=e.cursoringBlock)&&n.nextElementSibling||null),!(c=S(c)))return;O(o)||o.parentElement?.removeChild(o)}else{let e;if(!(e=o.parentElement))return;const t=o.cloneNode();t.appendChild(l),c=e.insertBefore(t,o.nextElementSibling)}(s=v(c))&&(e.range=C(s))}(e,t);break;case"Backspace":!function(e,t,n){let o,l,c,s;if(n.timerId||!(o=e.elm)||!(l=e.cursoringBlock)||!l.previousElementSibling||!(c=e.range)||!c.collapsed||!l.contains(c.commonAncestorContainer)||!(s=S(l)))return;const u=_(s)||l.firstChild;if(!u||!u.isSameNode(c.startContainer)||0!==c.startOffset)return;let a,d;if(!(a=k(c.startContainer,(e=>i(e))))||!(d=N(a)))return;c.setEnd(d,d.textContent?.length||0);const f=c.extractContents();let m;if(O(a)){let t,i,c,s;if(!(t=l.previousElementSibling)||!(i=S(t)))return;const u=i.childNodes.length>0?i.childNodes.length-1:0;if(!(c=N(i))||!(s=k(c,(e=>r(e)))))return;const a=c.textContent?.length||0;s.textContent?.length||(s.innerHTML=""),s.insertBefore(f,null),o.removeChild(l),c=i.childNodes.item(u)||i,c=N(c),n.timerId=setTimeout((()=>{e.range=h(c,a),clearTimeout(n.timerId),n.timerId=0}))}else{const t=e.renderNewBlock(f);if(m=o.insertBefore(t,l),!(m=S(m)))return;const n=v(m);e.range=C(n),a.remove()}}(e,0,n);break;case"Tab":!function(e,t){let n;if(t.preventDefault(),!(n=e.range))return;const o="Â ".repeat(4);n.collapsed||n.deleteContents(),n.insertNode(document.createTextNode(o)),n.collapse(!1),e.range=n}(e,t)}}function B(e){let t;(t=p())&&e.range!==t&&(e.range=t)}function L(e){return function(t){return t.getAttribute("role")===e}}const $=L(E.editor),D=L(E.block),O=L(E.blockContent);let R=0;function j(t,n={},l=[]){const c=R++,u=function(e,...t){let n=e;for(let e=0;e<t.length;e++)n=s(n,t[e]);return n}(w,n),a=u.classes;let g,p,h,C;const N=[];const v={get elm(){return b(t,(e=>r(e)&&$(e)&&e._uid===c))},get plugins(){return g},get range(){return h},set range(e){var t;(t=e)&&v.elm?.contains(t.commonAncestorContainer)&&k(t.commonAncestorContainer,(e=>r(e)&&O(e)))&&(h=e,(()=>{if(!h)return;const e=h.commonAncestorContainer,t=C;if(t&&t.contains(e))return;const n=k(e,(e=>r(e)&&D(e)));n&&(C=n,t?.classList.remove(a.focused),C.classList.add(a.focused))})(),function(){let e;for(let t=0;t<N.length;t++)e=N[t],e&&o(e)&&e.call(null)}(),(()=>{let e,t;if(C&&(e=S(C)))for(let n=0;n<e.childNodes.length;)t=e.childNodes.item(n),i(t)||t.textContent?.length?n++:e.removeChild(t)})())},onRangeSaved(e){e&&o(e)&&N.push(e)},get cursoringBlock(){return C},renderNewBlock(t="p",n={},o,r){let i="p",l=[];e(t)?i=t||"p":l=d(t),o&&(l=l.concat(d(o)));const c=f(i,m(n,u.readonly?{}:{contenteditable:!0},{role:E.blockContent}),l);if(r)for(let e in r)c[e]=r[e];return f("div",{class:u.classes?.block,role:E.block},c)}};g=function(e,t){let n;const r=new WeakMap;for(let i=0;i<t.length;i++)n=t[i],o(n[0])&&r.set(n[0],new n[0](e,...n[1]));return{get:e=>r.get(e)}}(v,l),p=u.readonly?{}:function(e){const t={isComposing:!1,isPointerDown:!1,timerId:0};return{onKeydown:n=>{t.isComposing||(B(e),A(e,n,t))},onKeyup:()=>{t.isComposing||B(e)},onCompositionstart:()=>{t.isComposing=!0},onCompositionend:()=>{t.isComposing=!1},onPointerdown:()=>{t.isPointerDown=!0},onPointerup:n=>{t.isPointerDown=!1,B(e)}}}(v);const y=v.renderNewBlock(),x=f("div",m({class:a.editor,role:E.editor},p),y);x._uid=c;const _=f("div",{role:E.container,class:a.container,spellcheck:"false",tabindex:"-1"},x);return t.appendChild(_),v}let T=0;class P{constructor(e){this.$editor=e,this._uid=++T}exec(){}isActive(){return!1}}function I(e){return class extends P{constructor(e){super(e),this._inner_role="list-"+this._uid}exec(){const{cursoringBlock:t,range:n,elm:o}=this.$editor;let r,i;if(!o||!t||!(r=S(t))||r.tagName===(e?"OL":"UL"))return;const l=e?"ol":"ul",c=document.createDocumentFragment();let s={};if(r.tagName===(e?"UL":"OL")){let e;for(let t=0;t<r.attributes.length;t++)e=r.attributes.item(t),e&&(s[e.name]=e.value);c.append(...r.childNodes)}else{s={class:"editor-list"};const e=y(r);c.append(f("li",{class:"editor-list-item"},e))}const u=this.$editor.renderNewBlock(l,s,c,{_inner_role:this._inner_role});i=t.nextElementSibling,o.removeChild(t);const a=N(o.insertBefore(u,i));var d;this.$editor.range=h(d=a,d.textContent?.length||0)}isActive(){let e;return!!(e=this.$editor.range)&&Boolean(k(e.startContainer,(e=>r(e)&&O(e)&&e._inner_role===this._inner_role)))}}}const q=I(!0),M=I();function F(e){return class extends P{constructor(e){super(e)}exec(t){document.execCommand(e,!1,t),this.$editor.range=p()}isActive(){return document.queryCommandState(e)}}}const H=F("bold"),K=F("italic");const U=function(){const t=[],n={use:(e,...o)=>(t.push([e,o||[]]),n),mount(n,o={}){const r=e(n)?document.querySelector(n):n;if(!r)throw new c(`No Such Element "${n}"`);return j(r,o,t)}};return n}().use(M).use(q).use(K).use(H).mount("#content");function Z(e,t){document.querySelector(e)?.addEventListener("click",(()=>{U.plugins.get(t)?.exec()}),!1)}function W(e,t,n="active"){let o,r=document.querySelector(e);r&&(o=U.plugins.get(t))&&(o.isActive()?r.classList.add(n):r.classList.remove(n))}Z("#ul",M),Z("#ol",q),Z("#bold",H),Z("#italic",K),U.onRangeSaved((()=>{W("#ul",M),W("#ol",q),W("#bold",H),W("#italic",K)}));
